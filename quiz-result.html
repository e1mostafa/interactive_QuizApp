<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Your Quiz Results - QuizApp</title>
  <style>
    body {
      background-color: #0f172a;
      color: white;
      font-family: Arial, sans-serif;
      padding: 30px;
    }
    h2, h3 {
      color: #facc15;
    }
    .result-card {
      background-color: #1e293b;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 25px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    .btn {
      background-color: #f7971e;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s ease;
      margin-top: 20px;
      display: inline-block;
      text-decoration: none;
    }
    .btn:hover {
      background-color: #cf7601;
    }
  </style>
</head>
<body>
  <h2>ğŸ‰ Your Quiz Results</h2>
  <div id="resultsContainer"></div>
  <a href="profile.html" class="btn">â¬…ï¸ Back to Profile</a>

  <script>
    const currentUser = JSON.parse(localStorage.getItem("loggedInUser"));
    if (!currentUser) {
      alert("Please login first.");
      window.location.href = "login.html";
    }

    const resultsContainer = document.getElementById("resultsContainer");

    // Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ ÙƒÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    // Ù†ÙØªØ±Ø¶ Ø£Ù† Ù†ØªØ§Ø¦Ø¬ ÙƒÙ„ ÙƒÙˆÙŠØ² Ù…Ø®Ø²Ù†Ø© ØªØ­Øª Ù…ÙØªØ§Ø­: results_<quizId>
    // ÙˆÙ†Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ ÙƒÙ„ Ù†ØªØ§Ø¦Ø¬ Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ

    const allQuizKeys = Object.keys(localStorage).filter(k => k.startsWith('quiz_'));
    if(allQuizKeys.length === 0) {
      resultsContainer.innerHTML = "<p>No quizzes available.</p>";
    }

    let userResultsFound = false;

    allQuizKeys.forEach(quizKey => {
      const quiz = JSON.parse(localStorage.getItem(quizKey));
      if(!quiz) return;

      const resultsKey = `results_${quiz.id}`;
      const results = JSON.parse(localStorage.getItem(resultsKey)) || [];

      // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆÙŠØ²
      const userResult = results.find(r => r.email === currentUser.email);
      if(userResult) {
        userResultsFound = true;

        // Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„ÙŠØ¯ÙˆÙŠ (Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯Ø©)
        const finalScore = userResult.finalScore !== undefined ? userResult.finalScore : userResult.score;

        const correctedStatus = userResult.corrected ? "âœ… ØªÙ… ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù†ØµÙŠØ©" : "â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„ÙŠØ¯ÙˆÙŠ";

        const maxScore = quiz.questions.length + (quiz.questions.filter(q => q.type === "text").length * 10); // Ù†ÙØªØ±Ø¶ Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„ Ù†ØµÙŠ 10 Ø¯Ø±Ø¬Ø§Øª

        const quizDiv = document.createElement("div");
        quizDiv.className = "result-card";

        quizDiv.innerHTML = `
          <h3>${quiz.title}</h3>
          <p><strong>Quiz ID:</strong> ${quiz.id}</p>
          <p><strong>Score:</strong> ${finalScore} / ${maxScore}</p>
          <p><strong>Status:</strong> ${correctedStatus}</p>
          <p><small>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${new Date(userResult.timestamp).toLocaleString()}</small></p>
        `;

        resultsContainer.appendChild(quizDiv);
      }
    });

    if(!userResultsFound) {
      resultsContainer.innerHTML = "<p>You have not taken any quizzes yet.</p>";
    }
  </script>
</body>
</html>
